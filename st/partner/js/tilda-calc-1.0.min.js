function _catch(t,e){try{var r=t()}catch(a){return e(a)}return r&&r.then?r.then(void 0,e):r}function tcalc__init(t,e){var r=document.querySelector("#rec"+t);if(r){var a=r.querySelectorAll('[data-input-lid="'+e+'"]'),c;if(Boolean(r.querySelector(".t-conditional-form"))){var n="conditional-form-init";r.addEventListener(n,(function(){for(var t=0;t<a.length;t++)l(a[t])}),{once:!0})}else for(var o=0;o<a.length;o++)l(a[o])}function l(e){if(e&&!e.getAttribute("data-init-calc")){var a=e.querySelector(".t-calc");a||(a=r.querySelector(".t-calc"));var c=a.getAttribute("data-calc-expr"),n=r.querySelectorAll(".t-select, .t-radio, .t-checkbox, .t-img-select, .t-rate"),o=r.querySelectorAll(".t-inputquantity__btn"),l=r.querySelectorAll(".t-input"),i=r.querySelectorAll(".t-range");if(c){var s=tcalc__getParseExpression(c=c.replace(/\s/g,"").replace(/,/g,"."));if(tcalc__cashOperandsFieldsEls(r,s),tcalc__cutAndHideFieldsValues(s),!0!==s.error){var u=function t(){tcalc__changeVal(r,e,a,tcalc__calcValue(s))};t_onFuncLoad("t_throttle",(function(){var t=t_throttle(u);l.forEach((function(e){e.addEventListener("input",t)}))})),n.forEach((function(t){t.addEventListener("change",u)})),o.forEach((function(t){t.addEventListener("click",(function(){setTimeout(u)}))})),i.forEach((function(t){["click","input","change"].forEach((function(e){t.addEventListener(e,u)}))})),e.addEventListener("recalculate",u),tcalc__addOperandsListeners(s,u),tcalc__addConditionalListeners(e,s),tcalc__changeVal(r,e,a,tcalc__calcValue(s)),e.setAttribute("data-init-calc","y"),e.dispatchEvent(new CustomEvent("inputReady")),e.setAttribute("data-input-ready","true");var d=r.querySelector(".t-quiz"),_;(d?d.querySelectorAll("button.t-submit"):r.querySelectorAll('[class$="-form__submit"] button.t-submit')).forEach((function(t){t.removeEventListener("click",tcalc__addProductsToCart,!0),t.addEventListener("click",tcalc__addProductsToCart,!0)}))}else console.log("Please check math expression or input names(especially spaces) in rec"+t)}else console.log("Error: formula field is empty in rec"+t)}}}function tcalc__getParseExpression(t){var e=t.split(""),r=[],a=[],c=0,n=!0;r[c]=Object.create(null),r[c].str="";for(var o=0;o<e.length;o++)"("!==e[o]&&")"!==e[o]&&("+"!==e[o]&&"-"!==e[o]&&"*"!==e[o]&&"/"!==e[o]||n?(r[c].str+=e[o],n=!1):(a[c]=e[o],r[++c]=Object.create(null),r[c].str="",n=!0));return{str:t,operands:r,operators:a}}function tcalc__cashOperandsFieldsEls(t,e){for(var r=0;r<e.operands.length;r++){var a=e.operands[r].str;if(isNaN(a)){var c=t.querySelectorAll('[name="'+a+'"]'),n=Array.from(c).some((function(t){return Boolean(t.closest(".t-input-group[data-conditionals], .t-conditional"))}));if(!c)return console.log("Error: incorrect operand: "+a),void(e.error=!0);e.operands[r].type="variable",e.operands[r].field=c,e.operands[r].hasConditionalField=n}else e.operands[r].type="number",e.operands[r].value=+e.operands[r].str}}function tcalc__cutAndHideFieldsValues(t){for(var e=0;e<t.operands.length;e++){var r=t.operands[e];"variable"===r.type&&tcalc__prepareFieldsValues(r.field)}}function tcalc__prepareFieldsValues(t){t.forEach((function(t){if(t){var e=t.classList.contains("t-select"),r=t.classList.contains("t-radio"),a=t.classList.contains("t-checkbox"),c=t.classList.contains("t-checkboxes__hiddeninput"),n=t.classList.contains("t-img-select"),o=t.classList.contains("t-img-select__hiddeninput"),l=t.classList.contains("t-rate");if(e)tcalc__cleanDropdownSelectValues(t);else if(a||r)tcalc__cleanRadioOrCheckboxValues(t);else if(n)tcalc__cleanImgSelectValues(t);else if(l)tcalc__setRateValues(t);else{var i=t.closest(".t-input-block");c?tcalc__prepareFieldsValues(i.querySelectorAll(".t-checkbox")):o&&tcalc__prepareFieldsValues(i.querySelectorAll(".t-img-select"))}}}))}function tcalc__changeVal(t,e,r,a){var c=e.querySelector(".t-calc__hiddeninput");c||(c=t.querySelector(".t-calc__hiddeninput"));var n=c.value,o;if(isNaN(a)?(r.innerHTML=0,c.value=0):(r.innerHTML=a,c.value=a),e.querySelector('input[type="hidden"][class^="t-calc__hidden__prod"]')){var l=e.closest(".t-form__inputsbox"),i=e.querySelector(".t-calc__hidden__prod_img"),s=e.querySelector(".t-calc__hidden__prod_title"),u,d="",_="",p=tcalc__parseProductOptions(e.querySelector(".t-calc__hidden__prod_options"));i&&(d=i.value||""),s&&(_=s.value||"NoName");var v={str:_,variables:[]},f=v.str.match(/[A-z0-9_]+/gi);for(var m in f){var h=l.querySelectorAll('[type="radio"][name="'+f[m]+'"]:checked');if(1===h.length)v.variables.push({str:f[m],value:h[0].value});else{var g=l.querySelectorAll('[name="'+f[m]+'"]');1===g.length&&v.variables.push({str:f[m],value:g[0].value})}}for(var y in v.variables){var b=v.variables[y].str,E=v.variables[y].value;if(E.indexOf("=")>0){for(var A=E.split(";"),S=[],m=0;m<A.length;m++){var x=A[m];x.indexOf("=")>0?S.push(x.split("=")[0]):S.push(x)}E=S.join(";")}b&&E&&(_=_.replace(new RegExp(b),E))}var L=t.querySelector(".t-quiz"),q,F="#order:"+_+"="+a;d&&(F+=":::image="+d),tcalc__processCalcProduct({inputGroup:e,title:_,img:d,price:a,submitBtns:L?L.querySelectorAll("button.t-submit"):l.querySelectorAll('[class$="-form__submit"] button.t-submit'),options:p})}Number(n)!==a&&t_triggerEvent(c,"change")}function tcalc__processCalcProduct(t){var e=t.inputGroup,r=t.title,a=t.img,c=t.price,n=t.submitBtns,o=t.options,l=null!==e.closest('[data-hidden-by-condition="true"]'),i=tcalc__productHelper(e);if(i){var s=e.getAttribute("data-input-lid"),u={name:r,price:c,img:a,options:o,recid:i.recId,lid:s,url:window.location.origin+window.location.pathname+"#rec"+i.recId};l?i.remove(s):i.set(s,u);var d=!i.isEmpty();n.forEach((function(t){t.removeAttribute("href"),t.setAttribute("type",d?"":"submit")}))}}window.productsFromCalc=window.productsFromCalc||{};var tcalc__addProductsToCart=function t(e){try{return Promise.resolve(_catch((function(){var t;if(document.querySelector(".t706")){var r,a=tcalc__productHelper(e.currentTarget);if(a&&!a.isEmpty())return e.stopPropagation(),e.preventDefault(),Promise.resolve(tcalc__prepareProductsForCart(a)).then((function(t){var e=a.rec.querySelector(".t-popup.t-popup_show");e&&t_onFuncLoad("t_popup__closePopup",(function(){t_popup__closePopup(e)})),t_onFuncLoad("tcart__addProduct",(function(){t.forEach((function(t){tcart__addProduct(t)}))}))}))}}),(function(t){console.error("Error trying to add calculator product to cart:",t)})))}catch(r){return Promise.reject(r)}};function tcalc__productHelper(t){var e=t.closest(".t-rec");if(e){var r=t.closest(".t396__elem"),a=e.getAttribute("id").replace("rec",""),c=r?r.getAttribute("data-elem-id"):a;window.productsFromCalc=window.productsFromCalc||{},window.productsFromCalc[c]=window.productsFromCalc[c]||{};var n=window.productsFromCalc[c];return{rec:e,recId:a,products:n,get:function t(e){return n[e]},set:function t(e,r){n[e]=r},remove:function t(e){n[e]&&delete n[e]},isEmpty:function t(){return 0===Object.keys(n).length},getAllProducts:function t(){return Object.values(n)}}}}function tcalc__parseProductOptions(t){return null!=t&&t.value?t.value.split("\n").map((function(t){var e=t.split("="),r=e[0],a=e[1];if(r)return{field:r.trim(),title:(a||"").trim()}})).filter(Boolean):[];var e,r}var tcalc__prepareProductOptions=function t(e,r){return e?e.map((function(t){var e=t.field,a=t.title,c=r[e]||"";return Array.isArray(c)&&(c=c.join("; ")),{option:a||e,variant:c}})):[]},tcalc__prepareProductsForCart=function t(e){try{return Promise.resolve(_catch((function(){var t=e.rec,r=e.getAllProducts;return Promise.resolve(tcalc__getUserFormData(t)).then((function(t){if(!t)return[];var e,a=r().map((function(e){try{return Promise.resolve(tcalc__prepareProductOptions(e.options,t)).then((function(t){return Object.assign({},e,{options:t})}))}catch(r){return Promise.reject(r)}}));return Promise.resolve(Promise.all(a))}))}),(function(t){console.error("Error preparing calculator products for cart:",t)})))}catch(r){return Promise.reject(r)}},tcalc__getUserFormData=function t(e){try{return Promise.resolve(_catch((function(){var t=e.querySelector(".t-form");return t?Promise.resolve(new Promise((function(t){return t_onFuncLoad("t_forms__getFormDataJSON",t)}))).then((function(){var e=window.t_forms__getFormDataJSON(t);return e||null})):null}),(function(t){return console.error("Error getting form data for calculator:",t),null})))}catch(r){return Promise.reject(r)}};function tcalc__calcValue(t){tcalc__getFieldsValues(t);for(var e=t.str,r=0;r<t.operands.length;r++){var a=t.operands[r],c=tcalc__isOperandFieldHiddenByCondition(a),n=tcalc__doesOperandFieldExist(a),o=c||!n?0:a.value;o=o<0?"(0"+o+")":o,e=e.replace(a.str,o)}try{var l=tcalc__evaluate(tcalc__parse(e))}catch(i){console.log("Something went wrong in form calculator! Please, connect support or developers")}return Math.round(10*l)/10}function tcalc__getFieldsValues(t){for(var e=0;e<t.operands.length;e++)if("variable"==t.operands[e].type){var r=t.operands[e].field;(r=Array.prototype.slice.call(r)).forEach((function(a){if(a){var c=a.classList.contains("t-img-select")&&"radio"===a.getAttribute("type"),n=a.classList.contains("t-img-select__hiddeninput");if(a.classList.contains("t-input")||a.classList.contains("t-range")||a.classList.contains("t-calc__hiddeninput")){var o=a.value;tcalc__getFieldsValues__saveToArr(t.operands[e],o)}if(a.classList.contains("t-select")){var l=a.querySelector("option:checked"),o=0;l&&(o=l.getAttribute("data-calc-value")),tcalc__getFieldsValues__saveToArr(t.operands[e],o)}if(a.classList.contains("t-radio")||a.classList.contains("t-checkbox")||a.classList.contains("t-rate")||c){var i=Array.prototype.filter.call(r,(function(t){if(t.checked)return t})),o=0;i[0]&&(o=i[0].getAttribute("data-calc-value")),tcalc__getFieldsValues__saveToArr(t.operands[e],o)}if(a.classList.contains("t-checkboxes__hiddeninput")||n){var s=a.closest(".t-input-block"),u=n?s.querySelectorAll(".t-img-select:checked"):s.querySelectorAll(".t-checkbox:checked"),d=0;Array.prototype.forEach.call(u,(function(t){var e=t.getAttribute("data-calc-value");e=e?e.replace(/[^0-9.]/g,""):0,d+=parseFloat(e)})),tcalc__getFieldsValues__saveToArr(t.operands[e],d.toString())}}}))}}function tcalc__getFieldsValues__saveToArr(t,e){var r=parseInt(e,10)<0;e=e?e.replace(/,/g,".").replace(/[^0-9.]/g,""):"",t.value=e?parseFloat(e):0,r&&(t.value=-t.value)}function t_triggerEvent(t,e){var r;document.createEvent?(r=document.createEvent("HTMLEvents")).initEvent(e,!0,!1):document.createEventObject&&((r=document.createEventObject()).eventType=e),r.eventName=e,t.dispatchEvent?t.dispatchEvent(r):t.fireEvent?t.fireEvent("on"+r.eventType,r):t[e]?t[e]():t["on"+e]&&t["on"+e]()}function tcalc__evaluate(t){switch(t.type){case"number":return parseFloat(t.value);case"+":return tcalc__evaluate(t.left)+tcalc__evaluate(t.right);case"-":return tcalc__evaluate(t.left)-tcalc__evaluate(t.right);case"*":return tcalc__evaluate(t.left)*tcalc__evaluate(t.right);case"/":return tcalc__evaluate(t.left)/tcalc__evaluate(t.right)}}function tcalc__parse(t){var e={tokens:tcalc__tokenize(t),position:0},r=tcalc__parseExpr(e);if(e.position!==e.tokens.length)throw new SyntaxError("unexpected '"+tcalc__peek(e)+"'");return r}function tcalc__tokenize(t){for(var e=[],r=/\s*([A-Za-z]+|[0-9.]+|\S)\s*/g,a;a=r.exec(t);)e.push(a[1]);return e}function tcalc__parseExpr(t){for(var e=tcalc__parseMulExpr(t),r=tcalc__peek(t);"+"===r||"-"===r;){var a;tcalc__consume(t),e={type:r,left:e,right:tcalc__parseMulExpr(t)},r=tcalc__peek(t)}return e}function tcalc__parseMulExpr(t){for(var e=tcalc__parsePrimaryExpr(t),r=tcalc__peek(t);"*"===r||"/"===r;){var a;tcalc__consume(t),e={type:r,left:e,right:tcalc__parsePrimaryExpr(t)},r=tcalc__peek(t)}return e}function tcalc__parsePrimaryExpr(t){var e=tcalc__peek(t);if(tcalc__isNumber(e))return tcalc__consume(t),{type:"number",value:e};if(tcalc__isName(e))return tcalc__consume(t),{type:"name",id:e};if("("===e){tcalc__consume(t);var r=tcalc__parseExpr(t);if(")"!==tcalc__peek(t))throw new SyntaxError("expected )");return tcalc__consume(t),r}throw new SyntaxError("expected a number, a variable, or parentheses")}function tcalc__peek(t){return t.tokens[t.position]}function tcalc__consume(t){t.position++}function tcalc__isName(t){return t&&t.match(/^[A-Za-z]+$/)}function tcalc__isNumber(t){return t&&t.match(/^[0-9.]+$/)}function tcalc__isOperandFieldHiddenByCondition(t){if("variable"===t.type)return t.hasConditionalField&&Array.from(t.field).some((function(t){var e=t.closest(".t-conditional"),r=t.closest(".t-input-group");return tcalc__isHiddenByCondition(e)||tcalc__isHiddenByCondition(r)}))}function tcalc__doesOperandFieldExist(t){return"variable"!==t.type||t.field.length>0}function tcalc__cleanImgSelectValues(t){var e=t.closest(".t-img-select__control"),r=e.querySelector(".t-img-select__text");if(r){var a=r.textContent.trim();if(a){var c=a.split("=");c.length<2||(c[0]?t.setAttribute("value",c[0]):t.setAttribute("value",e.querySelector(".t-img-select__indicator").getAttribute("data-original")),t.setAttribute("data-calc-value",c[1]),r.textContent=c[0])}}}function tcalc__setRateValues(t){t.setAttribute("data-calc-value",t.value)}function tcalc__cleanRadioOrCheckboxValues(t){var e=t.classList.contains("t-radio"),r=e?t.closest(".t-radio__control"):t.closest(".t-checkbox__control"),a=r.querySelector(".t-checkbox__labeltext"),c=r.textContent.trim();if(a&&(c=a.textContent),c){var n=c.split("=");if(!(n.length<2)){var o=n[0],l=n[1];if(t.closest(".t-input-group_rd")&&t.setAttribute("value",o),t.setAttribute("data-calc-value",l),a)a.textContent=o;else{var i;if(e?t.classList.contains("t-radio-ownanswer"):t.classList.contains("t-checkbox-ownanswer")){var s=e?r.querySelector(".t-radio__title"):r.querySelector(".t-checkbox__title");return s&&(s.textContent=o),void t.setAttribute("data-own-variant-title",o)}var u=r.querySelector("span:last-child");u&&(u.textContent=o)}}}}function tcalc__cleanDropdownSelectValues(t){var e=t.querySelectorAll("option");Array.prototype.forEach.call(e,(function(t){var e=t.value;if(e){var r=e.split("=");r.length<2||(t.value=r[0],t.innerHTML=r[0],t.setAttribute("data-calc-value",r[1]))}}))}function tcalc__addOperandsListeners(t,e){try{if(!t||!t.operands)return;t.operands.forEach((function(t){var r=t.field,a;"variable"===t.type&&r&&r.forEach((function(t){t.classList.contains("t-calc__hiddeninput")&&t.addEventListener("change",e)}))}))}catch(r){return void console.error("Error adding operands listeners:",r)}}function tcalc__isHiddenByCondition(t){return t&&"true"===t.getAttribute("data-hidden-by-condition")}function tcalc__addConditionalListeners(t,e){var r=e.operands,a=t.getAttribute("data-input-lid"),c=function e(){return t.dispatchEvent(new CustomEvent("recalculate"))},n=function t(e){e.removeEventListener("conditional-state-change",c),e.addEventListener("conditional-state-change",c)},o=r.flatMap((function(t){return"variable"!==t.type?[]:Array.from(t.field).flatMap((function(t){var e,r;return[t.closest(".t-conditional"),t.closest(".t-input-group[data-conditionals]")]})).filter(Boolean);var e,r})),l,i;o.some((function(t){var e;return JSON.parse(t.getAttribute("data-conditionals")).conditions.some((function(t){return t.fieldId===a}))}))?console.error("Could not add conditional listeners because of a circular dependency. Formula: "+e.str+". Input ID: "+a):(!!t.getAttribute("data-conditionals")&&n(t),o.forEach(n))}function tcalc__isTeam(){var t=document.getElementById("allrecords");return t&&"y"===t.getAttribute("data-tilda-te")}function tcalc__isTester(){var t=document.getElementById("allrecords");return t&&"y"===t.getAttribute("data-tilda-ts")}
